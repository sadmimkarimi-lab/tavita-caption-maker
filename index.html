<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <title>Ø³Ø§Ø²Ù†Ø¯Ù‡ Ú©Ù¾Ø´Ù† ØªØ§ÙˆÛŒØªØ§</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ Ø´Ø¨ÛŒÙ‡ Ø´Ø¨ÛŒÙ‡ ÛŒÚ©Ø§Ù† -->
    <link
      href="https://cdn.jsdelivr.net/gh/rastikerdar/shabnam-font/dist/font-face.css"
      rel="stylesheet"
    />

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        background: #f3f7f4;
        font-family: "Shabnam", sans-serif;
      }

      .app {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* ğŸ¨ Ù‡Ø¯Ø± Ø³Ø¨Ø² Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„ */
      .app-header {
        background: linear-gradient(135deg, #0f9d58, #12b565);
        color: #ffffff;
        padding: 14px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.25);
      }

      .app-header-avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .app-header-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .app-header-title {
        font-size: 18px;
        font-weight: 700;
      }

      .app-header-subtitle {
        font-size: 13px;
        opacity: 0.9;
      }

      /* Ø¨Ø¯Ù†Ù‡ */
      .chat-wrapper {
        flex: 1;
        display: flex;
        justify-content: center;
        padding: 10px;
      }

      .chat-container {
        width: 100%;
        max-width: 720px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 18px 18px 0 0;
        display: flex;
        flex-direction: column;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
      }

      .top-text {
        padding: 14px 16px 4px;
        font-size: 13px;
        color: #4b5563;
      }

      .top-text b {
        color: #065f46;
      }

      /* ÙØ±Ù… Ú©Ù¾Ø´Ù† */
      .form-section {
        padding: 8px 16px 4px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .field-label {
        font-size: 12px;
        color: #374151;
      }

      .field-description {
        font-size: 11px;
        color: #6b7280;
      }

      .field-row {
        display: flex;
        gap: 8px;
        margin-top: 4px;
      }

      .field-row > * {
        flex: 1;
      }

      .input, .select {
        width: 100%;
        border-radius: 10px;
        border: 1px solid #c4e2d3;
        padding: 8px 10px;
        font-size: 13px;
        font-family: inherit;
        background: #f5fbf7;
      }

      .input:focus,
      .select:focus {
        outline: none;
        border-color: #0f9d58;
        box-shadow: 0 0 0 2px rgba(15, 157, 88, 0.18);
        background: #ffffff;
      }

      .textarea {
        min-height: 72px;
        resize: vertical;
      }

      .helper-hint {
        font-size: 11px;
        color: #6b7280;
        margin-top: 3px;
      }

      .helper-hint span {
        color: #059669;
      }

      .build-row {
        padding: 8px 16px 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .emoji-button {
        background: #ffffff;
        border-radius: 10px;
        border: 1px solid #d5eadf;
        width: 40px;
        height: 36px;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .build-button {
        flex: 1;
        background: #0f9d58;
        color: #ffffff;
        border: none;
        border-radius: 12px;
        padding: 9px 14px;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(15, 157, 88, 0.35);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .build-button:active {
        transform: scale(0.97);
      }

      .build-note {
        padding: 0 16px;
        font-size: 11px;
        color: #6b7280;
      }

      /* Ù„ÛŒØ³Øª Ú©Ù¾Ø´Ù†â€ŒÙ‡Ø§ */
      .results {
        padding: 8px 12px 12px;
        overflow-y: auto;
        flex: 1;
      }

      .caption-card {
        border-radius: 14px;
        border: 1px solid #e5f3ec;
        padding: 10px 10px;
        margin-bottom: 8px;
        background: #ffffff;
        box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
        position: relative;
      }

      .caption-title {
        font-size: 12px;
        font-weight: 600;
        color: #065f46;
        margin-bottom: 4px;
      }

      .caption-text {
        font-size: 13px;
        line-height: 1.7;
        white-space: pre-wrap;
      }

      .caption-footer {
        margin-top: 6px;
        font-size: 11px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #6b7280;
      }

      .copy-btn {
        border: none;
        background: #ecfdf3;
        color: #047857;
        border-radius: 999px;
        padding: 4px 9px;
        font-size: 11px;
        cursor: pointer;
      }

      .tag-pill {
        border-radius: 999px;
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        padding: 2px 8px;
        font-size: 10px;
        color: #166534;
      }

      /* ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ */
      .status {
        font-size: 12px;
        padding: 4px 16px 8px;
        color: #6b7280;
      }

      .status.error {
        color: #b91c1c;
      }

      .status.loading {
        color: #047857;
      }

      /* Ù¾Ù†Ù„ Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø³Ø§Ø¯Ù‡ */
      .emoji-picker {
        position: absolute;
        z-index: 10;
        background: #ffffff;
        border-radius: 10px;
        box-shadow: 0 6px 18px rgba(15, 23, 42, 0.18);
        padding: 6px 8px;
        display: flex;
        gap: 4px;
      }

      .emoji-picker span {
        cursor: pointer;
        font-size: 18px;
        padding: 3px 5px;
        border-radius: 8px;
      }

      .emoji-picker span:hover {
        background: #f3f4f6;
      }

      .hidden {
        display: none;
      }

      @media (max-width: 600px) {
        .chat-container {
          border-radius: 0;
        }
      }
    </style>
  </head>

  <body>
    <div class="app">
      <!-- Ù‡Ø¯Ø± Ø³Ø¨Ø² Ø¨Ø§ Ù„ÙˆÚ¯ÙˆÛŒ Ø·Ø§ÙˆÛŒØªØ§ -->
      <header class="app-header">
        <div class="app-header-avatar">
          <img
            src="https://cdnfa.com/irangiah/a9be/uploads/new12/picsart-25-11-13-15-57-05-527.png"
            alt="Ù„ÙˆÚ¯Ùˆ Ø·Ø§ÙˆÛŒØªØ§"
          />
        </div>
        <div>
          <div class="app-header-title">Ø³Ø§Ø²Ù†Ø¯Ù‡ Ú©Ù¾Ø´Ù† ØªØ§ÙˆÛŒØªØ§</div>
          <div class="app-header-subtitle">Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒØªØ§</div>
        </div>
      </header>

      <div class="chat-wrapper">
        <div class="chat-container">
          <div class="top-text">
            Ø§ÛŒÙ†Ø¬Ø§ <b>Ø§ÛŒØ¯Ù‡ Ù¾Ø³Øª</b> Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³ØŒ Ù„Ø­Ù† Ùˆ Ù¾Ù„ØªÙØ±Ù… Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ØŒ
            ØªØ§ÙˆÛŒØªØ§ Ø¨Ø±Ø§Øª Ú†Ù†Ø¯ Ú©Ù¾Ø´Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ âœ¨
          </div>

          <div class="form-section">
            <div>
              <div class="field-label">Ø§ÛŒØ¯Ù‡ ÛŒØ§ ØªÙˆØ¶ÛŒØ­ Ù¾Ø³Øª</div>
              <textarea
                id="briefInput"
                class="input textarea"
                placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø¹Ø±ÙÛŒ Ø¯ÙˆØ±Ù‡ Ø¢Ù…ÙˆØ²Ø´ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ØŒ ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡ØŒ ØªØ£Ú©ÛŒØ¯ Ø±ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ Ø¨ÙˆØ¯Ù†."
              ></textarea>
              <div class="helper-hint">
                Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ù‡Ù… Ù…ÙˆØ¶ÙˆØ¹ØŒ Ù‡Ù… Ù…Ø®Ø§Ø·Ø¨ Ùˆ Ù‡Ù… Ù‡Ø¯Ù Ù¾Ø³Øª Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³
                <span>ØªØ§ Ú©Ù¾Ø´Ù† Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø´ÙˆØ¯</span>.
              </div>
            </div>

            <div class="field-row">
              <div>
                <div class="field-label">Ù¾Ù„ØªÙØ±Ù…</div>
                <select id="platformSelect" class="select">
                  <option value="Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…">Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</option>
                  <option value="Ø§ÛŒØªØ§">Ø§ÛŒØªØ§</option>
                  <option value="ØªÙ„Ú¯Ø±Ø§Ù…">ØªÙ„Ú¯Ø±Ø§Ù…</option>
                  <option value="ÛŒÙˆØªÛŒÙˆØ¨">ÛŒÙˆØªÛŒÙˆØ¨ / Ø´ÙˆØ±ØªØ²</option>
                  <option value="Ø¹Ù…ÙˆÙ…ÛŒ">Ù…ØªÙ† Ø¹Ù…ÙˆÙ…ÛŒ</option>
                </select>
              </div>
              <div>
                <div class="field-label">Ù„Ø­Ù† Ù…ØªÙ†</div>
                <select id="toneSelect" class="select">
                  <option value="ØµÙ…ÛŒÙ…ÛŒ Ùˆ Ø®ÙˆØ¯Ù…Ø§Ù†ÛŒ">ØµÙ…ÛŒÙ…ÛŒ Ùˆ Ø®ÙˆØ¯Ù…Ø§Ù†ÛŒ</option>
                  <option value="Ø±Ø³Ù…ÛŒ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ">Ø±Ø³Ù…ÛŒ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</option>
                  <option value="Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ">Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ</option>
                  <option value="ØªØ¨Ù„ÛŒØºØ§ØªÛŒ Ùˆ ÙØ±ÙˆØ´">ØªØ¨Ù„ÛŒØºØ§ØªÛŒ Ùˆ ÙØ±ÙˆØ´</option>
                  <option value="Ø¢Ù…ÙˆØ²Ø´ÛŒ">Ø¢Ù…ÙˆØ²Ø´ÛŒ</option>
                </select>
              </div>
            </div>
          </div>

          <div class="build-row">
            <button
              type="button"
              id="emojiBtn"
              class="emoji-button"
              aria-label="Ø§ÛŒÙ…ÙˆØ¬ÛŒ"
            >
              ğŸ™‚
            </button>
            <button id="buildBtn" class="build-button" type="button">
              âœ¨ Ø³Ø§Ø®Øª Ú©Ù¾Ø´Ù†
            </button>
          </div>
          <div class="build-note">
            Ù‡Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù…Ø³ØªÙ‚Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ø­Ø§ÙØ¸Ù‡ Ú†Øª Ù†Ø¯Ø§Ø±Ø¯) ØªØ§ Ø³Ø¨Ú©
            Ú©Ù¾Ø´Ù†â€ŒÙ‡Ø§ Ø«Ø§Ø¨Øª Ùˆ ØªÙ…ÛŒØ² Ø¨Ù…Ø§Ù†Ø¯ âœ…
          </div>

          <div id="status" class="status"></div>

          <div id="results" class="results"></div>

          <!-- Ù¾Ù†Ù„ Ø§ÛŒÙ…ÙˆØ¬ÛŒ -->
          <div id="emojiPicker" class="emoji-picker hidden">
            <span>ğŸ™‚</span>
            <span>ğŸ˜Š</span>
            <span>ğŸ˜‚</span>
            <span>ğŸ¥²</span>
            <span>âœ¨</span>
            <span>ğŸŒ±</span>
            <span>ğŸ’š</span>
            <span>ğŸš€</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      const briefInput = document.getElementById("briefInput");
      const platformSelect = document.getElementById("platformSelect");
      const toneSelect = document.getElementById("toneSelect");
      const buildBtn = document.getElementById("buildBtn");
      const statusEl = document.getElementById("status");
      const resultsEl = document.getElementById("results");
      const emojiBtn = document.getElementById("emojiBtn");
      const emojiPicker = document.getElementById("emojiPicker");

      let isLoading = false;

      function setStatus(text, type = "") {
        statusEl.textContent = text || "";
        statusEl.className = "status" + (type ? " " + type : "");
      }

      function addCaptionCard(index, text) {
        const card = document.createElement("div");
        card.className = "caption-card";

        const title = document.createElement("div");
        title.className = "caption-title";
        title.textContent = `Ú©Ù¾Ø´Ù† ${index}`;

        const body = document.createElement("div");
        body.className = "caption-text";
        body.textContent = text;

        const footer = document.createElement("div");
        footer.className = "caption-footer";

        const tag = document.createElement("div");
        tag.className = "tag-pill";
        tag.textContent = "ØªØ§ÙˆÛŒØªØ§ â€¢ caption maker";

        const copyBtn = document.createElement("button");
        copyBtn.className = "copy-btn";
        copyBtn.textContent = "Ú©Ù¾ÛŒ Ù…ØªÙ†";

        copyBtn.addEventListener("click", () => {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              copyBtn.textContent = "Ú©Ù¾ÛŒ Ø´Ø¯ âœ…";
              setTimeout(() => (copyBtn.textContent = "Ú©Ù¾ÛŒ Ù…ØªÙ†"), 1200);
            })
            .catch(() => {});
        });

        footer.appendChild(tag);
        footer.appendChild(copyBtn);

        card.appendChild(title);
        card.appendChild(body);
        card.appendChild(footer);

        resultsEl.appendChild(card);
      }

      async function buildCaptions() {
        const brief = briefInput.value.trim();
        const platform = platformSelect.value;
        const tone = toneSelect.value;

        if (!brief) {
          setStatus("Ù„Ø·ÙØ§Ù‹ Ø§ÙˆÙ„ ØªÙˆØ¶ÛŒØ­ Ù¾Ø³Øª Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³.", "error");
          return;
        }

        if (isLoading) return;
        isLoading = true;
        buildBtn.disabled = true;
        setStatus("Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª Ú©Ù¾Ø´Ù†â€ŒÙ‡Ø§ Ø¨Ø§ Ú©Ù…Ú© Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒâ€¦", "loading");
        resultsEl.innerHTML = "";

        const fullPrompt = `
Ù…Ù† Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù… Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ù¾Ø³Øª Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ú©Ù¾Ø´Ù† Ø¨Ù†ÙˆÛŒØ³ÛŒ.

Ø¬Ø²Ø¦ÛŒØ§Øª:
- ØªÙˆØ¶ÛŒØ­ Ù¾Ø³Øª: ${brief}
- Ù¾Ù„ØªÙØ±Ù…: ${platform}
- Ù„Ø­Ù†: ${tone}

Ù‚ÙˆØ§Ù†ÛŒÙ† ØªÙˆÙ„ÛŒØ¯ Ú©Ù¾Ø´Ù†:
- Û³ Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø¯Ù‡.
- Ù‡Ø± Ú©Ù¾Ø´Ù† Ø±Ø§ Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÙˆØ§Ø¶Ø­ Ø¨Ù†ÙˆÛŒØ³ (Û±)ØŒ Û²)ØŒ Û³)).
- Ù‡Ø± Ú©Ù¾Ø´Ù† Ø­Ø¯Ø§Ú©Ø«Ø± Û² Ø¬Ù…Ù„Ù‡ Ø¨Ø§Ø´Ø¯.
- Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ù…ØªØ¹Ø§Ø¯Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
- Ø§Ú¯Ø± Ù…Ù†Ø§Ø³Ø¨ Ø¨ÙˆØ¯ØŒ Ø¯Ø± Ù¾Ø§ÛŒØ§Ù† Ù‡Ø± Ú©Ù¾Ø´Ù† Û² ØªØ§ Û´ Ù‡Ø´ØªÚ¯ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù†ÙˆÛŒØ³.
- Ú©Ù¾Ø´Ù†â€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„Ø§Ù‹ ÙØ§Ø±Ø³ÛŒ Ø¨Ø§Ø´Ù†Ø¯ Ùˆ Ø¨Ø±Ø§ÛŒ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ø¬Ø°Ø§Ø¨ Ùˆ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡Ø›
- Ú©Ù¾Ø´Ù†â€ŒÙ‡Ø§ Ø¨Ø§ Ù‡Ù… Ù…ØªÙØ§ÙˆØª Ø¨Ø§Ø´Ù†Ø¯ (Ú©Ù¾ÛŒ Ù‡Ù…Ø¯ÛŒÚ¯Ø± Ù†Ø¨Ø§Ø´Ù†Ø¯).
        `.trim();

        try {
          const res = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: fullPrompt }),
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok || !data || data.ok === false || !data.answer) {
            const msg =
              (data && data.error) ||
              "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø³Ø® Ø§Ø² Ø³Ø±ÙˆØ±. Ú©Ù…ÛŒ Ø¨Ø¹Ø¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†.";
            setStatus(msg, "error");
            isLoading = false;
            buildBtn.disabled = false;
            return;
          }

          const answer = (data.answer || "").trim();
          if (!answer) {
            setStatus("Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†.", "error");
            isLoading = false;
            buildBtn.disabled = false;
            return;
          }

          // Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¬ÙˆØ§Ø¨ Ø±Ø§ Ø¨Ù‡ Ú†Ù†Ø¯ Ú©Ù¾Ø´Ù† Ø¬Ø¯Ø§ ØªÙ‚Ø³ÛŒÙ… Ú©Ù†ÛŒÙ…
          const parts = answer
            .split(/\n(?=\s*[0-9Û±-Û³][\).\)]\s)/) // Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Û±) ØŒ Û²) ...
            .map((p) => p.trim())
            .filter((p) => p.length > 0);

          resultsEl.innerHTML = "";

          if (parts.length === 0) {
            addCaptionCard(1, answer);
          } else {
            parts.forEach((part, idx) => {
              // Ø´Ù…Ø§Ø±Ù‡ Ø±Ø§ Ø§Ø² Ø§Ø¨ØªØ¯Ø§ÛŒ Ø®Ø· Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
              const cleaned = part.replace(/^[0-9Û°-Û¹][\).\)]\s*/, "").trim();
              addCaptionCard(idx + 1, cleaned || part);
            });
          }

          setStatus("âœ… Ú©Ù¾Ø´Ù†â€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§Ù†Ø¯. Ù‡Ø±Ú©Ø¯Ø§Ù… Ø±Ø§ Ø¯ÙˆØ³Øª Ø¯Ø§Ø´ØªÛŒ Ú©Ù¾ÛŒ Ú©Ù†.");
        } catch (err) {
          console.error(err);
          setStatus(
            "âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø±Ø® Ø¯Ø§Ø¯. Ø§ÛŒÙ†ØªØ±Ù†Øª / ÙÛŒÙ„ØªØ±Ø´Ú©Ù† Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†.",
            "error"
          );
        } finally {
          isLoading = false;
          buildBtn.disabled = false;
        }
      }

      buildBtn.addEventListener("click", buildCaptions);

      // Ù¾Ù†Ù„ Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡â€ŒÚ©Ø±Ø¯Ù† Ø¨Ù‡ ØªÙˆØ¶ÛŒØ­ Ù¾Ø³Øª
      emojiBtn.addEventListener("click", (e) => {
        e.preventDefault();
        const rect = emojiBtn.getBoundingClientRect();
        emojiPicker.style.top = rect.top + window.scrollY - 60 + "px";
        emojiPicker.style.left =
          rect.left + window.scrollX - emojiPicker.offsetWidth / 2 + "px";
        emojiPicker.classList.toggle("hidden");
      });

      emojiPicker.querySelectorAll("span").forEach((span) => {
        span.addEventListener("click", () => {
          const emoji = span.textContent;
          briefInput.value = (briefInput.value + " " + emoji).trim();
          briefInput.focus();
          emojiPicker.classList.add("hidden");
        });
      });

      document.addEventListener("click", (e) => {
        if (
          !emojiPicker.contains(e.target) &&
          e.target !== emojiBtn &&
          !emojiBtn.contains(e.target)
        ) {
          emojiPicker.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
